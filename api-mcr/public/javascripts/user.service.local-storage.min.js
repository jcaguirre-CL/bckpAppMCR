(function(){'use strict';angular.module('app').service('UsuarioService',UsuarioService).factory('UserService',UserService);UserService.$inject=['$timeout','$filter','$q','UsuarioService','$http'];function UserService($timeout,$filter,$q,UsuarioService,$http){var service={};service.GetAll=GetAll;service.GetById=GetById;service.GetByUsername=GetByUsername;service.Create=Create;service.Update=Update;service.Delete=Delete;return service;function GetAll(){var promise=UsuarioService.recuperarUsuarios();return promise}
function GetById(id){var deferred=$q.defer();var filtered=$filter('filter')(getUsers(),{id:id});var user=filtered.length?filtered[0]:null;deferred.resolve(user);return deferred.promise}
function GetByUsername(username){var promise=UsuarioService.recuperarUsuarioUsername(username);return promise}
function Create(user){var deferred=$q.defer();$timeout(function(){GetByUsername(user.username).then(function(duplicateUser){try{var usuario=JSON.parse(JSON.stringify(duplicateUser)).data.username;deferred.resolve({success:!1,message:'Usuario: "'+user.username+'" ya existe'})}
catch(err){var promise=UsuarioService.crearUsuario(user);promise.then(function(response){}).catch(function(error){console.log("Problemas al conectar con la API")});deferred.resolve({success:!0})}})},500);return deferred.promise}
function Update(user){var deferred=$q.defer();var users=getUsers();for(var i=0;i<users.length;i++){if(users[i].id===user.id){users[i]=user;break}}
setUsers(users);deferred.resolve();return deferred.promise}
function Delete(username){var deferred=$q.defer();var promise=UsuarioService.borrarUsuarioUsername(username);promise.then(function(response){}).catch(function(error){console.log("Problemas al conectar con la API")});deferred.resolve();return deferred.promise}
function getUsers(){var promiseGetAll={};promiseGetAll=UsuarioService.recuperarUsuarios();promiseGetAll.then(function(response){return response.data}).catch(function(error){console.log("Problemas al conectar con la API")});if(!localStorage.users){localStorage.users=JSON.stringify([])}}
function setUsers(users){localStorage.users=JSON.stringify(users)}}
UsuarioService.$inject=['$http'];function UsuarioService($http){var usuario=this;usuario.crearUsuario=function(registro){var response=$http({method:"POST",url:("http://10.128.2.25:3000/api/Users"),headers:{'Content-Type':'application/json'},data:registro});return response};usuario.recuperarUsuarios=function(){var response=$http({method:"GET",url:("http://10.128.2.25:3000/api/Users")});return response};usuario.recuperarUsuarioUsername=function(username){var response=$http({method:"GET",url:("http://10.128.2.25:3000/api/Users/username/"+username)});return response};usuario.borrarUsuarioUsername=function(username){var response=$http({method:"POST",url:("http://10.128.2.25:3000/api/Users/username/"+username)});return response}}})()
