(function(){'use strict';angular.module('app').controller('ingresarRegistroController',ingresarRegistroController).service('FormularioService',FormularioService).service('ShoppingListService',ShoppingListService);ingresarRegistroController.$inject=['FormularioService','ShoppingListService','$rootScope','UserService','$filter','$q','$http'];function ingresarRegistroController(FormularioService,ShoppingListService,$rootScope,UserService,$filter,$q,$http){var ingresar=this;var objShared={};var promise={};var scope=$rootScope;var selectPrograma=document.getElementById("prog");var selectResponsable=document.getElementById("resp");var selectOperador=document.getElementById("oper");updateClock();scope.sharedUno={};ingresar.formData={};ingresar.placeResponsable="";ingresar.placeOperador="";ingresar.placeProgramas="";ingresar.informado=!1;ingresar.duracionfalla=0;ingresar.areafalla=0;ingresar.tipofalla=0;ingresar.servicio=0;ingresar.senal=0;ingresar.CurrentDate=new Date();var promise=FormularioService.recuperarRegistros();function campos(key){var d=$q.defer();var response=$http({method:"GET",url:("http://10.128.2.25:3000/api/Campos/"+key)});d.resolve(response);return d.promise}
var camposArray=["programas","responsables","operadores"];var asyncLoop=function(o){var j=-1,length=o.length;var loop=function(){j++;if(j==length){o.callback();return}
o.functionToLoop(loop,j)}
loop()}
asyncLoop({length:3,functionToLoop:function(loop,j){var promiseCampos=campos(camposArray[j]).then(function(response){var promises=[];for(var i=0;i<response.data.length;i++){promises.push(response.data[i].value)}
$q.all(promises).then(function(dataArray){var string1=JSON.stringify(dataArray);var string2=camposArray[j];eval("ingresar."+string2+" = "+string1)})});loop()},callback:function(){}});var promiseRecuperar={};var promiseMarcar={};var promiseModificar={};var promiseBorrar={};ingresar.listado=[];promise.then(function(response){ingresar.listado=response.data}).catch(function(error){console.log("Problemas al conectar con la API")});ingresar.selectPrograma=function(){ingresar.placePrograma=ingresar.programa;ingresar.valuePrograma=ingresar.programa;selectPrograma.selectedIndex=0};ingresar.selectResponsable=function(){ingresar.placeResponsable=ingresar.responsable;ingresar.valueResponsable=ingresar.responsable;selectResponsable.selectedIndex=0};ingresar.selectOperador=function(){ingresar.placeOperador=ingresar.operador;ingresar.valueOperador=ingresar.operador;selectOperador.selectedIndex=0};ingresar.crearRegistro=function(){if(ingresar.responsable){ingresar.formData.fechaevento=ingresar.fechaevento;ingresar.formData.programa=ingresar.programa;ingresar.formData.descripcion=ingresar.descripcion;ingresar.formData.operador=ingresar.operador;ingresar.formData.responsable=ingresar.responsable;ingresar.formData.duracionfalla=ingresar.duracionfalla;ingresar.formData.areafalla=ingresar.areafalla;ingresar.formData.tipofalla=ingresar.tipofalla;ingresar.formData.servicio=ingresar.servicio;ingresar.formData.senal=ingresar.senal;ingresar.formData.informado=ingresar.informado;promise=FormularioService.crearRegistros(ingresar.formData);promise.then(function(){$rootScope.shared=ShoppingListService.addItem(ingresar.formData);ingresar.descripcion="";ingresar.programa="";ingresar.fechaevento="";ingresar.responsable="";ingresar.operador="";ingresar.placeResponsable="";ingresar.placePrograma="";ingresar.placeOperador="";ingresar.valueOperador="";ingresar.valuePrograma="";ingresar.valueResponsable="";ingresar.duracionfalla=0;ingresar.areafalla=0;ingresar.tipofalla=0;ingresar.servicio=0;ingresar.senal=0;ingresar.informado=!1;selectPrograma.selectedIndex=0;selectResponsable.selectedIndex=0;selectOperador.selectedIndex=0;promiseRecuperar=FormularioService.recuperarRegistros();ingresar.listado=[];promiseRecuperar.then(function(response){ingresar.listado=response.data}).catch(function(error){console.log("Problemas al conectar con la API")})}).catch(function(error){console.log("Problemas al conectar con la API")})}};ingresar.modificarRegistro=function(id){ingresar.formData.fechaevento=ingresar.fechaevento;ingresar.formData.descripcion=ingresar.descripcion;ingresar.formData.programa=ingresar.valuePrograma;ingresar.formData.responsable=ingresar.valueResponsable;ingresar.formData.operador=ingresar.valueOperador;ingresar.formData.duracionfalla=ingresar.duracionfalla;ingresar.formData.areafalla=ingresar.areafalla;ingresar.formData.tipofalla=ingresar.tipofalla;ingresar.formData.servicio=ingresar.servicio;ingresar.formData.senal=ingresar.senal;ingresar.formData.informado=ingresar.informado;promise=FormularioService.modificarRegistros(ingresar.registroID,ingresar.formData);promise.then(function(){ingresar.fechaevento="";ingresar.operador="";ingresar.descripcion="";ingresar.programa="";ingresar.responsable="";ingresar.placeResponsable="";ingresar.placePrograma="";ingresar.placeOperador="";ingresar.valueOperador="";ingresar.valuePrograma="";ingresar.valueResponsable="";ingresar.duracionfalla=0;ingresar.areafalla=0;ingresar.tipofalla=0;ingresar.servicio=0;ingresar.senal=0;ingresar.informado=!1;selectPrograma.selectedIndex=0;selectResponsable.selectedIndex=0;selectOperador.selectedIndex=0;promiseModificar=FormularioService.recuperarRegistros();ingresar.listado=[];promiseModificar.then(function(response){ingresar.listado=response.data}).catch(function(error){console.log("Problemas al conectar con la API")})}).catch(function(error){console.log("Problemas al conectar con la API")})};ingresar.borrarRegistro=function(id){promise=FormularioService.eliminarRegistros(ingresar.registroID);promise.then(function(){ingresar.fechaevento="";ingresar.operador="";ingresar.descripcion="";ingresar.programa="";ingresar.responsable="";ingresar.placeResponsable="";ingresar.placePrograma="";ingresar.placeOperador="";ingresar.valueResponsable="";ingresar.valuePrograma="";ingresar.valueOperador="";ingresar.duracionfalla=0;ingresar.areafalla=0;ingresar.tipofalla=0;ingresar.servicio=0;ingresar.senal=0;ingresar.informado=!1;selectPrograma.selectedIndex=0;selectOperador.selectedIndex=0;selectResponsable.selectedIndex=0;promiseBorrar=FormularioService.recuperarRegistros();ingresar.listado=[];promiseBorrar.then(function(response){ingresar.listado=response.data}).catch(function(error){console.log("Problemas al conectar con la API")})}).catch(function(error){console.log("Problemas al conectar con la API")})};ingresar.verificarCompletada=function(boleano){return(boleano)};ingresar.marcarRegistro=function(id){promiseMarcar=FormularioService.recuperarUno(id);promiseMarcar.then(function(response){ingresar.fechaevento=$filter('date')(response.data.fechaevento,'d MMMM y / HH:mm:ss')
ingresar.descripcion=response.data.descripcion;ingresar.placeResponsable=response.data.responsable;ingresar.placePrograma=response.data.programa;ingresar.placeOperador=response.data.operador;ingresar.valueOperador=response.data.operador;ingresar.valuePrograma=response.data.programa;ingresar.valueResponsable=response.data.responsable;ingresar.duracionfalla=response.data.duracionfalla;ingresar.areafalla=response.data.areafalla;ingresar.tipofalla=response.data.tipofalla;ingresar.servicio=response.data.servicio;ingresar.senal=response.data.senal;ingresar.informado=response.data.informado;ingresar.registroID=response.data._id;selectPrograma.selectedIndex=0;selectResponsable.selectedIndex=0;selectOperador.selectedIndex=0}).catch(function(error){console.log("Problemas al conectar con la API")})};ingresar.resetFiltro1=function(){ingresar.filtro1="";ingresar.filtroText1=""};ingresar.resetFiltro2=function(){ingresar.filtro2=""};ingresar.resetFiltro3=function(){ingresar.filtro3=""};ingresar.aplicarFiltro1=function(){ingresar.filtro1=ingresar.filtroText1};scope.$watch("sharedUno.descripcion",function(newValue,oldValue,scope){ingresar.descripcion=scope.sharedUno.descripcion;ingresar.placeResponsable=scope.sharedUno.responsable;ingresar.placePrograma=scope.sharedUno.programa;ingresar.placeOperador=scope.sharedUno.operador;ingresar.valueResponsable=scope.sharedUno.responsable;ingresar.valuePrograma=scope.sharedUno.programa;ingresar.valueOperador=scope.sharedUno.operador;ingresar.registroID=scope.sharedUno._id;selectPrograma.selectedIndex=0;selectResponsable.selectedIndex=0;selectOperador.selectedIndex=0});$(function(){var links=$('.sidebar-links > div');links.on('click',function(){links.removeClass('selected');$(this).addClass('selected')})})}
function updateClock(){var now=new Date(),months=['Enero','Febrero','Marzo','Abril','Mayo','Junio','Julio','Agosto','Septiembre','Octubre','Noviembre','Diciembre'];var time=now.getHours()+':'+now.getMinutes()+':'+now.getSeconds();var timeArticle=now.getHours()+':'+now.getMinutes();var date=[now.getDate(),months[now.getMonth()],now.getFullYear()].join(' ');document.getElementById('fechaevento').innerHTML=[date,time].join(' / ');setTimeout(updateClock,1000)}
function ShoppingListService(){var service=this;var items={};service.addItem=function(objShared){items=objShared;return items};service.getnewItems=function(){return items}}
FormularioService.$inject=['$http'];function FormularioService($http){var service=this;service.recuperarRegistros=function(){var response=$http({method:"GET",url:("http://10.128.2.25:3000/api")});return response};service.recuperarObjetos=function(objeto){var response=$http({method:"GET",url:("http://10.128.2.25:3000/api/Campos/"+objeto)});return response};service.recuperarUno=function(id){var response=$http({method:"GET",url:("http://10.128.2.25:3000/api/"+id)});return response};service.crearRegistros=function(registro){var response=$http({method:"POST",url:("http://10.128.2.25:3000/api"),headers:{'Content-Type':'application/json'},data:registro});return response};service.modificarRegistros=function(registroID,objeto){var response=$http({method:"PUT",url:("http://10.128.2.25:3000/api/"+registroID),heardes:{'Content-Type':'application/json'},data:objeto});return response};service.eliminarRegistros=function(id){var response=$http({method:"DELETE",url:("http://10.128.2.25:3000/api/"+id),headers:{'Content-Type':'application/json'}});return response}}})()
