(function(){'use strict';angular.module('app').controller('notificarRegistroController',notificarRegistroController).service('FormularioService',FormularioService).service('ShoppingListService',ShoppingListService);notificarRegistroController.$inject=['FormularioService','ShoppingListService','$rootScope','UserService','$timeout','FlashService'];function notificarRegistroController(FormularioService,ShoppingListService,$rootScope,UserService,$timeout,FlashService){var notificar=this;var objShared={};var promise={};var scope=$rootScope;scope.sharedUno={};notificar.formData={};notificar.responsables=["giglesias","malvear","hmeza","gerardo.pizarro","csalinas","mmendezp","jcaguirre"];notificar.placeResponsable="";notificar.operadores=["operador1","operador2","operador3","operador4","operador5","operador6","operador7"];notificar.placeOperador="";notificar.programas=["Teletrece AM","Teletrece Tarde","Teletrece","Teletrece Noche","Bievenidos","etc.."];notificar.placeProgramas="";notificar.CurrentDate=new Date();notificar.listaCorreo="";loadCurrentUser();function loadCurrentUser(){UserService.GetByUsername($rootScope.globals.currentUser.username).then(function(user){notificar.userRemitente=JSON.parse(JSON.stringify(user)).data.nombre})}
var promise=FormularioService.recuperarRegistros();var promiseRecuperar={};var promiseMarcar={};var promiseRemover={};var promiseModificar={};var promiseBorrar={};var promiseEnviar={};var listaEventos=[];notificar.listado=[];promise.then(function(response){notificar.listado=response.data}).catch(function(error){console.log("Problemas al conectar con la API")});notificar.updateSelection=function($event,id){var checkbox=$event.target;var action=(checkbox.checked?'add':'remove');updateSelected(action,id)};notificar.verificarCompletada=function(boleano){return(boleano)};var updateSelected=function(action,id){if(action==='add'){listaEventos.push(id)}
if(action==='remove'){listaEventos.splice(listaEventos.indexOf(id),1)}};notificar.sendMail=function(correo){var timer;notificar.enviandoCorreo=!0;promiseEnviar=FormularioService.sendMail(correo,listaEventos,notificar.userRemitente);promiseEnviar.then(function(response){timer=$timeout(function(){notificar.enviandoCorreo=!1;FlashService.Success('Correo enviado correctamente!!!',!0);var asyncLoop=function(o){var j=-1,length=o.length;var loop=function(){j++;if(j==length){o.callback();return}
o.functionToLoop(loop,j)}
loop()}
asyncLoop({length:listaEventos.length,functionToLoop:function(loop,j){var promiseNoti=FormularioService.notificarRegistro(listaEventos[j]).then(function(response){});loop()},callback:function(){}})},1000)}).catch(function(error){notificar.enviandoCorreo=!1;FlashService.Error('Problemas al enviar correo!!!');console.log("Problemas al conectar con la API")})}
notificar.resetFiltro1=function(){notificar.filtro1="";notificar.filtroText1=""};notificar.resetFiltro2=function(){notificar.filtro2=""};notificar.resetFiltro3=function(){notificar.filtro3=""};notificar.aplicarFiltro1=function(){notificar.filtro1=notificar.filtroText1};$(function(){var links=$('.sidebar-links > div');links.on('click',function(){links.removeClass('selected');$(this).addClass('selected')})})}
function ShoppingListService(){var service=this;var items={};service.addItem=function(objShared){items=objShared;return items};service.getnewItems=function(){return items}}
FormularioService.$inject=['$http'];function FormularioService($http){var service=this;service.recuperarRegistros=function(){var response=$http({method:"GET",url:("http://10.128.2.25:3000/api")});return response};service.recuperarUno=function(id){var response=$http({method:"GET",url:("http://10.128.2.25:3000/api/"+id)});return response};service.sendMail=function(correo,listado,remitente){var response=$http({method:"GET",url:("http://10.128.2.25:3000/api/sendMail/"+correo+"/"+listado+"/"+remitente)});return response};service.crearRegistros=function(registro){var response=$http({method:"POST",url:("http://10.128.2.25:3000/api"),headers:{'Content-Type':'application/json'},data:registro});return response};service.modificarRegistros=function(registroID,objeto){var response=$http({method:"PUT",url:("http://10.128.2.25:3000/api/"+registroID),heardes:{'Content-Type':'application/json'},data:objeto});return response};service.notificarRegistro=function(registroID){var response=$http({method:"PUT",url:("http://10.128.2.25:3000/api/informado/"+registroID),heardes:{'Content-Type':'application/json'}});return response};service.eliminarRegistros=function(id){var response=$http({method:"DELETE",url:("http://10.128.2.25:3000/api/"+id),headers:{'Content-Type':'application/json'}});return response}}})()
